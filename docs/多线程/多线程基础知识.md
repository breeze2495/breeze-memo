###     P1: ç¨‹åº,è¿›ç¨‹,çº¿ç¨‹çš„ç†è§£

1ã€ç¨‹åº(programm) æ¦‚å¿µï¼šæ˜¯ä¸ºå®Œæˆç‰¹å®šä»»åŠ¡ã€ç”¨æŸç§è¯­è¨€ç¼–å†™çš„ä¸€ç»„æŒ‡ä»¤çš„é›†åˆã€‚å³æŒ‡ä¸€æ®µé™æ€çš„ä»£ç ã€‚

2ã€è¿›ç¨‹(process) æ¦‚å¿µï¼šç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ–æ˜¯æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åºã€‚ è¯´æ˜ï¼šè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„å•ä½ï¼Œç³»ç»Ÿåœ¨è¿è¡Œæ—¶ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸åŒçš„å†…å­˜åŒºåŸŸ

3ã€çº¿ç¨‹(thread) æ¦‚å¿µï¼šè¿›ç¨‹å¯è¿›ä¸€æ­¥ç»†åŒ–ä¸ºçº¿ç¨‹ï¼Œæ˜¯ä¸€ä¸ªç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚ è¯´æ˜ï¼šçº¿ç¨‹ä½œä¸ºCPUè°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨(pc)ï¼Œçº¿ç¨‹åˆ‡æ¢çš„å¼€é”€å°ã€‚





### P2: å¹¶è¡Œä¸å¹¶å‘

**å¹¶è¡Œä¸å¹¶å‘**

å¹¶è¡Œ:å¤šä¸ªCPUåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡

å¹¶å‘:ä¸€ä¸ªCPU(é‡‡ç”¨æ—¶é—´ç‰‡)åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡



### P3: åˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹æ³•

#### p1: ç»§æ‰¿Threadç±»

1. åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºThreadç±»çš„å­ç±»
2. é‡å†™Threadç±»çš„run() --> å°†æ­¤çº¿ç¨‹æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨run()ä¸­
3. åˆ›å»ºThreadç±»çš„å­ç±»çš„å¯¹è±¡
4. é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨start()

**ğŸ´ä»£ç ä¸¾ä¾‹**

```Java
//1. åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºThreadç±»çš„å­ç±»
class MyThread extends Thread {
    //2. é‡å†™Threadç±»çš„run()
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            if(i % 2 == 0){
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}


public class ThreadTest {
    public static void main(String[] args) {
        //3. åˆ›å»ºThreadç±»çš„å­ç±»çš„å¯¹è±¡
        MyThread t1 = new MyThread();

        //4.é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨start():â‘ å¯åŠ¨å½“å‰çº¿ç¨‹ â‘¡ è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()
        t1.start();
        //é—®é¢˜ä¸€ï¼šæˆ‘ä»¬ä¸èƒ½é€šè¿‡ç›´æ¥è°ƒç”¨run()çš„æ–¹å¼å¯åŠ¨çº¿ç¨‹ã€‚
				//t1.run();

        /*
        é—®é¢˜äºŒï¼šå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œéå†100ä»¥å†…çš„å¶æ•°ã€‚ä¸å¯ä»¥è¿˜è®©å·²ç»start()çš„çº¿ç¨‹å»æ‰§è¡Œã€‚
        ä¼šæŠ¥IllegalThreadStateException
        */    
				//t1.start();
        //æˆ‘ä»¬éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„å¯¹è±¡
        MyThread t2 = new MyThread();
        t2.start();


        //å¦‚ä¸‹æ“ä½œä»ç„¶æ˜¯åœ¨mainçº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚
        for (int i = 0; i < 100; i++) {
            if(i % 2 == 0){
                System.out.println(Thread.currentThread().getName() + ":" + i + "*******  ****main()************");
            }
        }
    }

}
```



#### p2: å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹

1. åˆ›å»ºä¸€ä¸ªå®ç°äº†Runnableæ¥å£çš„ç±»
2. å®ç°ç±»å»å®ç°Runnableä¸­çš„æŠ½è±¡æ–¹æ³•ï¼šrun()
3. åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
4. å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadç±»çš„å¯¹è±¡
5. é€šè¿‡Threadç±»çš„å¯¹è±¡è°ƒç”¨start()

å¼€å‘ä¸­ï¼š**ä¼˜å…ˆé€‰æ‹©**å®ç°Runnableæ¥å£çš„æ–¹å¼ 

åŸå› ï¼šå®ç°çš„æ–¹å¼æ²¡æœ‰ç±»çš„å•ç»§æ‰¿æ€§çš„å±€é™æ€§ï¼Œå®ç°çš„æ–¹å¼æ›´é€‚åˆæ¥å¤„ç†å¤šä¸ªçº¿ç¨‹æœ‰å…±äº«æ•°æ®çš„æƒ…å†µã€‚

ä¼˜ç‚¹: å°†å¯æ‰§è¡Œçš„é€»è¾‘å•å…ƒä¸çº¿ç¨‹æ§åˆ¶åˆ†ç¦»å¼€æ¥,è¿™ä¹Ÿæ˜¯é¢å‘å¯¹è±¡çš„ä¸€ä¸ªé‡è¦çš„æ€æƒ³.

```java
//1. åˆ›å»ºä¸€ä¸ªå®ç°äº†Runnableæ¥å£çš„ç±»
class MThread implements Runnable{

    //2. å®ç°ç±»å»å®ç°Runnableä¸­çš„æŠ½è±¡æ–¹æ³•ï¼šrun()
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            if(i % 2 == 0){
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}



public class ThreadTest1 {
    public static void main(String[] args) {
        //3. åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
        MThread mThread = new MThread();
        //4. å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadç±»çš„å¯¹è±¡
        Thread t1 = new Thread(mThread);
        t1.setName("çº¿ç¨‹1");

        /*
        5. é€šè¿‡Threadç±»çš„å¯¹è±¡è°ƒç”¨start():â‘  å¯åŠ¨çº¿ç¨‹ â‘¡è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()-->
        è°ƒç”¨äº†Runnableç±»å‹çš„targetçš„run()
        */
        t1.start();

        //å†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œéå†100ä»¥å†…çš„å¶æ•°
        Thread t2 = new Thread(mThread);
        t2.setName("çº¿ç¨‹2");
        t2.start();
    }

}
```



#### p3: Threadå’ŒRunnableçš„å…³ç³»

**è”ç³»**ï¼špublic class Thread **implements** Runnable 

**ç›¸åŒç‚¹**ï¼šä¸¤ç§æ–¹å¼éƒ½éœ€è¦é‡å†™run(),å°†çº¿ç¨‹è¦æ‰§è¡Œçš„é€»è¾‘å£°æ˜åœ¨run()ä¸­ã€‚



##### D1: Runnableæ¥å£æ„é€ çº¿ç¨‹æºç 

```java
/*ä¸‹é¢æ˜¯Threadç±»çš„éƒ¨åˆ†æºç */

//1.ç”¨Runnableæ¥å£åˆ›å»ºçº¿ç¨‹æ—¶ä¼šè¿›å…¥è¿™ä¸ªæ–¹æ³•
public Thread(Runnable target) {
        init(null, target, "Thread-" + nextThreadNum(), 0);
    }

//2.æ¥ç€è°ƒç”¨è¿™ä¸ªæ–¹æ³•
private void init(ThreadGroup g, Runnable target, String name,
                      long stackSize) {
        init(g, target, name, stackSize, null, true);
    }

//3.å†è°ƒç”¨è¿™ä¸ªæ–¹æ³•
private void init(ThreadGroup g, Runnable target, String name,
                      long stackSize, AccessControlContext acc,
                      boolean inheritThreadLocals) {
        if (name == null) {
            throw new NullPointerException("name cannot be null");
        }

        this.name = name;

        Thread parent = currentThread();
        SecurityManager security = System.getSecurityManager();
        if (g == null) {
            /* Determine if it's an applet or not */

            /* If there is a security manager, ask the security manager
               what to do. */
            if (security != null) {
                g = security.getThreadGroup();
            }

            /* If the security doesn't have a strong opinion of the matter
               use the parent thread group. */
            if (g == null) {
                g = parent.getThreadGroup();
            }
        }

        /* checkAccess regardless of whether or not threadgroup is
           explicitly passed in. */
        g.checkAccess();

        /*
         * Do we have the required permissions?
         */
        if (security != null) {
            if (isCCLOverridden(getClass())) {
                security.checkPermission(SUBCLASS_IMPLEMENTATION_PERMISSION);
            }
        }

        g.addUnstarted();

        this.group = g;
        this.daemon = parent.isDaemon();
        this.priority = parent.getPriority();
        if (security == null || isCCLOverridden(parent.getClass()))
            this.contextClassLoader = parent.getContextClassLoader();
        else
            this.contextClassLoader = parent.contextClassLoader;
        this.inheritedAccessControlContext =
                acc != null ? acc : AccessController.getContext();
        //4.æœ€ååœ¨è¿™é‡Œå°†Runnableæ¥å£(target)èµ‹å€¼ç»™Threadè‡ªå·±çš„targetæˆå‘˜å±æ€§     
        this.target = target;
        setPriority(priority);
        if (inheritThreadLocals && parent.inheritableThreadLocals != null)
            this.inheritableThreadLocals =
                ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);
        /* Stash the specified stack size in case the VM cares */
        this.stackSize = stackSize;

        /* Set thread ID */
        tid = nextThreadID();
    }

/*å¦‚æœä½ æ˜¯å®ç°äº†runnableæ¥å£ï¼Œé‚£ä¹ˆåœ¨ä¸Šé¢çš„ä»£ç ä¸­targetä¾¿ä¸ä¼šä¸ºnullï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šé€šè¿‡é‡å†™çš„
è§„åˆ™å»è°ƒç”¨çœŸæ­£å®ç°äº†Runnableæ¥å£(ä½ ä¹‹å‰ä¼ è¿›æ¥çš„é‚£ä¸ªRunnableæ¥å£å®ç°ç±»)çš„ç±»é‡Œçš„runæ–¹æ³•*/
@Override
    public void run() {
    
        if (target != null) {
            target.run();
        }
    }
```

1ã€å¤šçº¿ç¨‹çš„è®¾è®¡ä¹‹ä¸­ï¼Œä½¿ç”¨äº†**ä»£ç†è®¾è®¡æ¨¡å¼**çš„ç»“æ„ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„çº¿ç¨‹ä¸»ä½“åªæ˜¯è´Ÿè´£é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½çš„å®ç°ï¼Œè€Œæ‰€æœ‰çš„è¾…åŠ©å®ç°å…¨éƒ¨äº¤ç”±Threadç±»æ¥å¤„ç†ã€‚ 

2ã€åœ¨è¿›è¡ŒThreadå¯åŠ¨å¤šçº¿ç¨‹çš„æ—¶å€™è°ƒç”¨çš„æ˜¯start()æ–¹æ³•ï¼Œè€Œåæ‰¾åˆ°çš„æ˜¯run()æ–¹æ³•ï¼Œä½†é€šè¿‡Threadç±»çš„æ„é€ æ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªRunnableæ¥å£å¯¹è±¡çš„æ—¶å€™ï¼Œé‚£ä¹ˆè¯¥æ¥å£å¯¹è±¡å°†è¢«Threadç±»ä¸­çš„targetå±æ€§æ‰€ä¿å­˜ï¼Œåœ¨start()æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ä¼šè°ƒç”¨Threadç±»ä¸­çš„run()æ–¹æ³•ã€‚è€Œè¿™ä¸ªrun()æ–¹æ³•å»è°ƒç”¨å®ç°äº†Runnableæ¥å£çš„é‚£ä¸ªç±»æ‰€é‡å†™è¿‡run()æ–¹æ³•ï¼Œè¿›è€Œæ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚å¤šçº¿ç¨‹å¼€å‘çš„æœ¬è´¨å®è´¨ä¸Šæ˜¯åœ¨äºå¤šä¸ªçº¿ç¨‹å¯ä»¥è¿›è¡ŒåŒä¸€èµ„æºçš„æŠ¢å ï¼Œé‚£ä¹ˆThreadä¸»è¦æè¿°çš„æ˜¯çº¿ç¨‹ï¼Œè€Œèµ„æºçš„æè¿°æ˜¯é€šè¿‡Runnableå®Œæˆçš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src="/Users/breeze/Library/Application Support/typora-user-images/image-20210420085929032.png" alt="image-20210420085929032" style="zoom:33%;float:left" />

##### D2: Threadç±»æ„é€ çº¿ç¨‹æºç 

```java
MyThread t2 = new MyThread(); //è¿™ä¸ªæ„é€ å‡½æ•°ä¼šé»˜è®¤è°ƒç”¨Super();ä¹Ÿå°±æ˜¯Threadç±»çš„æ— å‚æ„é€ 
```

```java
//ä»£ç ä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œ
public Thread() {
        init(null, null, "Thread-" + nextThreadNum(), 0);
    }
    
private void init(ThreadGroup g, Runnable target, String name,
                      long stackSize) {
        init(g, target, name, stackSize, null, true);
    }
    
private void init(ThreadGroup g, Runnable target, String name,
                      long stackSize, AccessControlContext acc,
                      boolean inheritThreadLocals) {
        if (name == null) {
            throw new NullPointerException("name cannot be null");
        }

        this.name = name;

        Thread parent = currentThread();
        SecurityManager security = System.getSecurityManager();
        if (g == null) {
            /* Determine if it's an applet or not */

            /* If there is a security manager, ask the security manager
               what to do. */
            if (security != null) {
                g = security.getThreadGroup();
            }

            /* If the security doesn't have a strong opinion of the matter
               use the parent thread group. */
            if (g == null) {
                g = parent.getThreadGroup();
            }
        }

        /* checkAccess regardless of whether or not threadgroup is
           explicitly passed in. */
        g.checkAccess();

        /*
         * Do we have the required permissions?
         */
        if (security != null) {
            if (isCCLOverridden(getClass())) {
                security.checkPermission(SUBCLASS_IMPLEMENTATION_PERMISSION);
            }
        }

        g.addUnstarted();

        this.group = g;
        this.daemon = parent.isDaemon();
        this.priority = parent.getPriority();
        if (security == null || isCCLOverridden(parent.getClass()))
            this.contextClassLoader = parent.getContextClassLoader();
        else
            this.contextClassLoader = parent.contextClassLoader;
        this.inheritedAccessControlContext =
                acc != null ? acc : AccessController.getContext();
        this.target = target;
        setPriority(priority);
        if (inheritThreadLocals && parent.inheritableThreadLocals != null)
            this.inheritableThreadLocals =
                ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);
        /* Stash the specified stack size in case the VM cares */
        this.stackSize = stackSize;

        /* Set thread ID */
        tid = nextThreadID();
    }

/*ç”±äºè¿™é‡Œæ˜¯é€šè¿‡ç»§æ‰¿Threadç±»æ¥å®ç°çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆtargetè¿™ä¸ªä¸œè¥¿å°±æ˜¯Nullã€‚ä½†æ˜¯å› ä¸ºä½ ç»§æ‰¿
äº†Runnableæ¥å£å¹¶ä¸”é‡å†™äº†run()ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨å­ç±»çš„run()*/
 @Override
    public void run() {
        if (target != null) {
            target.run();
        }
    }
```

##### D3: æœ€ç›´è§‚çš„ä»£ç æè¿°

```java
// ç»§æ‰¿Threadç±»
class Window extends Thread{

    private  int ticket = 100;
    @Override
    public void run() {
        while(true){
            if(ticket > 0){
                System.out.println(getName() + "ï¼šå–ç¥¨ï¼Œç¥¨å·ä¸ºï¼š" + ticket);
                ticket--;
            }else{
                break;
            }
        }
    }
}


public class WindowTest {
    public static void main(String[] args) {
        Window t1 = new Window();
        Window t2 = new Window();
        Window t3 = new Window();

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();

    }
}
```

```java
// å®ç°Runnableæ¥å£
class Window1 implements Runnable{

    private int ticket = 100;

    @Override
    public void run() {
        while(true){
            if(ticket > 0){
                System.out.println(Thread.currentThread().getName() + ":å–ç¥¨ï¼Œç¥¨å·ä¸ºï¼š" + ticket);
                ticket--;
            }else{
                break;
            }
        }
    }
}


public class WindowTest1 {
    public static void main(String[] args) {
        Window1 w = new Window1();

        Thread t1 = new Thread(w);
        Thread t2 = new Thread(w);
        Thread t3 = new Thread(w);

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }

}
```

1ã€ç»§æ‰¿Threadç±»çš„æ–¹å¼ï¼Œnewäº†ä¸‰ä¸ªThreadï¼Œå®é™…ä¸Šæ˜¯æœ‰300å¼ ç¥¨ã€‚

2ã€å®ç°Runnableæ¥å£çš„æ–¹å¼ï¼Œnewäº†ä¸‰ä¸ªThreadï¼Œå®é™…ä¸Šæ˜¯æœ‰100å¼ ç¥¨ã€‚

3ã€ä¹Ÿå°±æ˜¯è¯´å®ç°Runnableæ¥å£çš„çº¿ç¨‹ä¸­ï¼Œæˆå‘˜å±æ€§æ˜¯æ‰€æœ‰çº¿ç¨‹å…±æœ‰çš„ã€‚ä½†æ˜¯ç»§æ‰¿Threadç±»çš„çº¿ç¨‹ä¸­ï¼Œæˆå‘˜å±æ€§æ˜¯å„ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ï¼Œå…¶å®ƒçº¿ç¨‹çœ‹ä¸åˆ°ï¼Œé™¤éé‡‡ç”¨staticçš„æ–¹å¼æ‰èƒ½ä½¿å„ä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ã€‚

4ã€å°±åƒä¸Šé¢è¯´çš„Runnableç›¸å½“äºèµ„æºï¼ŒThreadæ‰æ˜¯çº¿ç¨‹ã€‚ç”¨Runnableåˆ›å»ºçº¿ç¨‹æ—¶ï¼Œnewäº†å¤šä¸ªThreadï¼Œä½†æ˜¯ä¼ è¿›å»çš„å‚æ•°éƒ½æ˜¯åŒä¸€ä¸ªRunnableï¼ˆèµ„æºï¼‰ã€‚ç”¨Threadåˆ›å»ºçº¿ç¨‹æ—¶ï¼Œå°±ç›´æ¥newäº†å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„Runnableï¼ˆèµ„æºï¼‰ã€‚åœ¨Threadæºç ä¸­å°±æ˜¯ç”¨targetå˜é‡ï¼ˆè¿™æ˜¯ä¸€ä¸ªRunnableç±»å‹çš„å˜é‡ï¼‰æ¥è¡¨ç¤ºè¿™ä¸ªèµ„æºã€‚

5ã€åŒæ—¶å› ä¸ºè¿™ä¸¤ä¸ªçš„åŒºåˆ«ï¼Œåœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œç»§æ‰¿äº†Threadçš„å­ç±»åœ¨è¿›è¡Œçº¿ç¨‹åŒæ­¥æ—¶ä¸èƒ½å°†æˆå‘˜å˜é‡å½“åšé”ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹æ‹¿åˆ°çš„ä¸æ˜¯åŒä¸€æŠŠé”ï¼Œä¸è¿‡ç”¨staticå˜é‡å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è€Œå®ç°äº†Runnableæ¥å£çš„ç±»åœ¨è¿›è¡Œçº¿ç¨‹åŒæ­¥æ—¶æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚



#### p4: å®ç°callableæ¥å£åˆ›å»ºçº¿ç¨‹

```Java
//Callableå®ç°å¤šçº¿ç¨‹
class MyThread implements Callable<String> {//çº¿ç¨‹çš„ä¸»ä½“ç±»

    @Override
    public String call() throws Exception {
        for (int x = 0; x < 10; x++) {
            System.out.println("*******çº¿ç¨‹æ‰§è¡Œï¼Œx=" + x + "********");
        }
        return "çº¿ç¨‹æ‰§è¡Œå®Œæ¯•";
    }
}

public class Demo1 {
    public static void main(String[] args) throws Exception {
        FutureTask<String> task = new FutureTask<>(new MyThread());
        new Thread(task).start();
        System.out.println("çº¿ç¨‹è¿”å›æ•°æ®" + task.get());

    }
}
```

Callableæœ€ä¸»è¦çš„å°±æ˜¯æä¾›å¸¦æœ‰è¿”å›å€¼çš„callæ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹ã€‚ä¸è¿‡Callableè¦å’ŒFutureå®ç°ç±»è¿ç€ç”¨ï¼Œå…³äºFutureçš„ä¸€ç³»åˆ—çŸ¥è¯†ä¼šåœ¨åé¢å‡ ä¸ªç³»åˆ—è®²åˆ°ã€‚



### P4: ç­–ç•¥æ¨¡å¼åœ¨Threadå’ŒRunnableä¸­çš„åº”ç”¨

Runnableæ¥å£æœ€é‡è¦çš„æ–¹æ³•-----runæ–¹æ³•ï¼Œä½¿ç”¨äº†**ç­–ç•¥è€…æ¨¡å¼**å°†æ‰§è¡Œçš„é€»è¾‘(runæ–¹æ³•)å’Œç¨‹åºçš„æ‰§è¡Œå•å…ƒ(start0æ–¹æ³•)åˆ†ç¦»å‡ºæ¥ï¼Œä½¿ç”¨æˆ·å¯ä»¥å®šä¹‰è‡ªå·±çš„ç¨‹åºå¤„ç†é€»è¾‘ï¼Œæ›´ç¬¦åˆé¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚



### P5: Threadçš„æ„é€ æ–¹æ³•

- åˆ›å»ºçº¿ç¨‹å¯¹è±¡Threadï¼Œ`é»˜è®¤æœ‰ä¸€ä¸ªçº¿ç¨‹åï¼Œä»¥Thread-å¼€å¤´ï¼Œä»0å¼€å§‹è®¡æ•°`ï¼Œå¦‚â€œThread-0ã€Thread-1ã€Thread-2 â€¦â€
- å¦‚æœæ²¡æœ‰ä¼ é€’Runnableæˆ–è€…æ²¡æœ‰è¦†å†™Threadçš„runæ–¹æ³•ï¼Œ`è¯¥Threadä¸ä¼šè°ƒç”¨ä»»ä½•æ–¹æ³•`
- å¦‚æœä¼ é€’Runnableæ¥å£çš„å®ä¾‹æˆ–è€…è¦†å†™runæ–¹æ³•ï¼Œåˆ™`ä¼šæ‰§è¡Œè¯¥æ–¹æ³•çš„é€»è¾‘å•å…ƒ`ï¼ˆé€»è¾‘ä»£ç ï¼‰
- å¦‚æœæ„é€ çº¿ç¨‹å¯¹è±¡æ—¶ï¼Œæœªä¼ å…¥ThreadGroupï¼Œ`Threadä¼šé»˜è®¤è·å–çˆ¶çº¿ç¨‹çš„ThreadGroupä½œä¸ºè¯¥çº¿ç¨‹çš„ThreadGroup`ï¼Œæ­¤æ—¶å­çº¿ç¨‹å’Œçˆ¶çº¿ç¨‹ä¼šåœ¨åŒä¸€ä¸ªThreadGroupä¸­
- stackSizeå¯ä»¥`æé«˜çº¿ç¨‹æ ˆçš„æ·±åº¦`ï¼Œæ”¾æ›´å¤šæ ˆå¸§ï¼Œä½†æ˜¯ä¼š`å‡å°‘èƒ½åˆ›å»ºçš„çº¿ç¨‹æ•°ç›®`
- stackSizeé»˜è®¤æ˜¯0ï¼Œ`å¦‚æœæ˜¯0ï¼Œä»£è¡¨ç€è¢«å¿½ç•¥ï¼Œè¯¥å‚æ•°ä¼šè¢«JNIå‡½æ•°è°ƒç”¨`ï¼Œä½†æ˜¯æ³¨æ„æŸäº›å¹³å°å¯èƒ½ä¼šå¤±æ•ˆï¼Œ`å¯ä»¥é€šè¿‡â€œ-Xss10mâ€è®¾ç½®`

å…·ä½“çš„ä»‹ç»å¯ä»¥çœ‹Javaçš„APIæ–‡æ¡£

```Java
/*ä¸‹é¢æ˜¯Thread çš„éƒ¨åˆ†æºç */

public Thread(Runnable target) {
    init(null, target, "Thread-" + nextThreadNum(), 0);
}

public Thread(String name) {
    init(null, null, name, 0);
}
        â†“ â†“    â†“    
         â†“ â†“    
          â†“    
private void init(ThreadGroup g, Runnable target, String name,
                      long stackSize) {
    init(g, target, name, stackSize, null, true);
}
        â†“ â†“    â†“    
         â†“ â†“    
          â†“    
private void init(ThreadGroup g, Runnable target, String name,
                      long stackSize, AccessControlContext acc,
                      boolean inheritThreadLocals) {
    //ä¸­é—´æºç çœç•¥
    this.target = target;//â‘ 
}

/* What will be run. */
private Runnable target; //Threadç±»ä¸­çš„targetå±æ€§

@Override
public void run() {
    if (target != null) { //â‘¡
        target.run();
    }
}
```

> æºç æ ‡è®°è§£è¯»ï¼š
>
> 1ã€å¦‚æœThreadç±»çš„æ„é€ æ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªRunnableæ¥å£å¯¹è±¡
>
> â‘ é‚£ä¹ˆè¯¥æ¥å£å¯¹è±¡å°†è¢«Threadç±»ä¸­çš„targetå±æ€§æ‰€ä¿å­˜ã€‚
>
> â‘¡åœ¨start()æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ä¼šè°ƒç”¨Threadç±»ä¸­çš„run()æ–¹æ³•ã€‚å› ä¸ºtargetä¸ä¸ºnullï¼Œ target.run()å°±å»è°ƒç”¨å®ç°Runnableæ¥å£çš„å­ç±»é‡å†™çš„run()ã€‚
>
> 2ã€å¦‚æœThreadç±»çš„æ„é€ æ–¹ä¼ æ²¡ä¼ Runnableæ¥å£å¯¹è±¡
>
> â‘ Threadç±»ä¸­çš„targetå±æ€§ä¿å­˜çš„å°±æ˜¯nullã€‚
>
> â‘¡åœ¨start()æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ä¼šè°ƒç”¨Threadç±»ä¸­çš„run()æ–¹æ³•ã€‚å› ä¸ºtargetä¸ºnullï¼Œåªèƒ½å»è°ƒç”¨ç»§æ‰¿Threadçš„å­ç±»æ‰€é‡å†™çš„run()ã€‚

JVMä¸€æ—¦å¯åŠ¨ï¼Œè™šæ‹Ÿæœºæ ˆçš„å¤§å°å·²ç»ç¡®å®šäº†ã€‚ä½†æ˜¯å¦‚æœä½ åˆ›å»ºThreadçš„æ—¶å€™ä¼ äº†stackSizeï¼ˆè¯¥çº¿ç¨‹å ç”¨çš„stackå¤§å°ï¼‰ï¼Œè¯¥å‚æ•°ä¼šè¢«JNIå‡½æ•°å»ä½¿ç”¨ã€‚å¦‚æœæ²¡ä¼ è¿™ä¸ªå‚æ•°ï¼Œå°±é»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå¿½ç•¥è¿™ä¸ªå‚æ•°ã€‚æ³¨ï¼šstackSizeåœ¨æœ‰ä¸€äº›å¹³å°ä¸Šæ˜¯æ— æ•ˆçš„ã€‚



### P6: Start() æºç 

```Java
public synchronized void start() {
   
    if (threadStatus != 0)
        throw new IllegalThreadStateException();//â‘ 

   
    group.add(this);

    boolean started = false;
    try {
        start0();
        started = true;
    } finally {
        try {
            if (!started) {
                group.threadStartFailed(this);
            }
        } catch (Throwable ignore) {
            /* do nothing. If start0 threw a Throwable then
              it will be passed up the call stack */
        }
    }
}

private native void start0();


@Override
public void run() {
    if (target != null) {
        target.run();
    }
}
```

> **æºç æ ‡è®°è§£è¯»ï¼š**
>
> â‘ å½“å¤šæ¬¡è°ƒç”¨start()ï¼Œä¼šæŠ›å‡ºthrow new IllegalThreadStateException()å¼‚å¸¸ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªçº¿ç¨‹ç±»çš„å¯¹è±¡åªå…è®¸å¯åŠ¨ä¸€æ¬¡ï¼Œå¦‚æœé‡å¤å¯åŠ¨åˆ™å°±æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚



#### p1: ä¸ºä»€ä¹ˆçº¿ç¨‹çš„å¯åŠ¨ä¸ç›´æ¥ä½¿ç”¨run()è€Œæ˜¯ä½¿ç”¨start()?

1ã€å¦‚æœç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Œç›¸å½“äºå°±æ˜¯ç®€å•çš„è°ƒç”¨ä¸€ä¸ªæ™®é€šæ–¹æ³•ã€‚

<img src="/Users/breeze/Library/Application Support/typora-user-images/image-20210420092637635.png" alt="image-20210420092637635" style="zoom:33%;float:left" />

2ã€run()çš„è°ƒç”¨æ˜¯åœ¨start0()è¿™ä¸ªNative C++æ–¹æ³•é‡Œè°ƒç”¨çš„



### P7: çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ

| **çŠ¶æ€åç§°** | **è¯´æ˜**                                                     |
| ------------ | ------------------------------------------------------------ |
| NEW          | åˆå§‹çŠ¶æ€,çº¿ç¨‹è¢«æ„å»º,ä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨Start()æ–¹æ³•;               |
| RUNNABLE     | è¿è¡ŒçŠ¶æ€,å½“è¿è¡Œstartæ–¹æ³•,å­çº¿ç¨‹è¢«åˆ›å»ºæˆåŠŸä¹‹å,å­çº¿ç¨‹çš„çŠ¶æ€å˜æˆRUNNABLE; |
| BLOCKED      | çº¿ç¨‹é˜»å¡,å¦‚æœçº¿ç¨‹æ­£å¥½åœ¨ç­‰å¾…è·å¾— monitor lock é”ï¼Œæ¯”å¦‚åœ¨ç­‰å¾…è¿›å…¥ synchronized ä¿®é¥°çš„ä»£ç å—æˆ–æ–¹æ³•æ—¶ï¼Œä¼šä» RUNNABLE å˜æˆ BLOCKED; |
| TERMINATED   | è¿è¡Œç»“æŸ,å­çº¿ç¨‹è¿è¡Œå®Œæˆ,è¢«æ‰“æ–­,ç»ˆæ­¢,çŠ¶æ€éƒ½ä¼šä»RUNNABLEç¼–ç¨‹TEMINATED; |
| WAITING      | ç­‰å¾…çŠ¶æ€,è¯¥çŠ¶æ€è¡¨ç¤ºå½“å‰çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹åšå‡ºä¸€äº›ç‰¹å®šåŠ¨ä½œ(é€šçŸ¥æˆ–ä¸­æ–­); |
| TIME_WAITING | è¶…æ—¶ç­‰å¾…çŠ¶æ€,ä¸åŒäºWAITING,å®ƒæ˜¯å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´è‡ªè¡Œè¿”å›çš„;   |

<img src="/Users/breeze/Library/Application Support/typora-user-images/image-20210421142356811.png" alt="image-20210421142356811" style="zoom:50%;float:left" />

> å›¾ä¸­ waitåˆ° runnableçŠ¶æ€çš„è½¬æ¢ä¸­ï¼Œ`join`å®é™…ä¸Šæ˜¯`Thread`ç±»çš„æ–¹æ³•ï¼Œä½†è¿™é‡Œå†™æˆäº†`Object`ã€‚

1ã€ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šçº¿ç¨‹åˆ›å»ºä¹‹åå®ƒå°†å¤„äº **NEWï¼ˆæ–°å»ºï¼‰** çŠ¶æ€ï¼Œè°ƒç”¨ `start()` æ–¹æ³•åå¼€å§‹è¿è¡Œï¼Œçº¿ç¨‹è¿™æ—¶å€™å¤„äº **READYï¼ˆå¯è¿è¡Œï¼‰** çŠ¶æ€ã€‚å¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è·å¾—äº† CPU æ—¶é—´ç‰‡ï¼ˆtimesliceï¼‰åå°±å¤„äº **RUNNINGï¼ˆè¿è¡Œï¼‰** çŠ¶æ€ã€‚

2ã€æ“ä½œç³»ç»Ÿéšè— Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­çš„ READY å’Œ RUNNING çŠ¶æ€ï¼Œå®ƒåªèƒ½çœ‹åˆ° RUNNABLE çŠ¶æ€ï¼Œæ‰€ä»¥ Java ç³»ç»Ÿä¸€èˆ¬å°†è¿™ä¸¤ä¸ªçŠ¶æ€ç»Ÿç§°ä¸º **RUNNABLEï¼ˆè¿è¡Œä¸­ï¼‰** çŠ¶æ€ ã€‚

3ã€è°ƒç”¨sleep()æ–¹æ³•ï¼Œä¼šè¿›å…¥BlockedçŠ¶æ€ã€‚sleep()ç»“æŸä¹‹åï¼ŒBlockedçŠ¶æ€é¦–å…ˆå›åˆ°çš„æ˜¯RunnableçŠ¶æ€ä¸­çš„Readyï¼ˆä¹Ÿå°±æ˜¯å¯è¿è¡ŒçŠ¶æ€ï¼Œä½†å¹¶æœªè¿è¡Œï¼‰ã€‚åªæœ‰æ‹¿åˆ°äº†cpuçš„æ—¶é—´ç‰‡æ‰ä¼šè¿›å…¥Runnableä¸­çš„RunningçŠ¶æ€ã€‚



### P8: ä¸€ä¸ªJAVAç¨‹åºæœ‰å“ªäº›çº¿ç¨‹?

- å½“è°ƒç”¨ä¸€ä¸ªçº¿ç¨‹start()æ–¹æ³•æ—¶,æ­¤æ—¶è‡³å°‘æœ‰ä¸¤ä¸ªçº¿ç¨‹,ä¸€ä¸ªç”¨æ¥è°ƒç”¨ä½ çš„çº¿ç¨‹(main),ä¸€ä¸ªæ˜¯è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹

  ```java
  public static void main(String[] args) {
      Thread t1 = new Thread() {
          @Override
          public void run() {
              System.out.println("==========");
          }
      };
      t1.start();
  }
  ```

- JVMå¯åŠ¨å,å®é™…ä¸Šä¼šæœ‰å¤šä¸ªçº¿ç¨‹,ä½†è‡³å°‘ä¼šæœ‰ä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹(ä¾‹å¦‚mainçº¿ç¨‹)

  <img src="/Users/breeze/Library/Application Support/typora-user-images/image-20210425161147819.png" alt="image-20210425161147819" style="zoom:33%;float:left" />

  - Finalizerï¼šGCå®ˆæŠ¤çº¿ç¨‹
  - RMIï¼šJavaè‡ªå¸¦çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆç§‹æ‹›é¢è¯•ï¼Œæœ‰ä¸ªé¢è¯•å®˜é—®è¿‡ï¼‰
  - Monitor ï¼šæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œè´Ÿè´£ç›‘å¬ä¸€äº›æ“ä½œï¼Œä¹Ÿåœ¨mainçº¿ç¨‹ç»„ä¸­
  - å…¶å®ƒï¼šæˆ‘ç”¨çš„æ˜¯IDEAï¼Œå…¶å®ƒçš„åº”è¯¥æ˜¯IDEAçš„çº¿ç¨‹ï¼Œæ¯”å¦‚é¼ æ ‡ç›‘å¬å•¥çš„ã€‚



### P9: å®ˆæŠ¤çº¿ç¨‹

- Daemonçº¿ç¨‹æ˜¯ä¸€ç§æ”¯æŒå‹çº¿ç¨‹,ä¸»è¦è¢«ç”¨ä½œç¨‹åºä¸­åå°è°ƒåº¦ä»¥åŠæ”¯æŒæ€§å·¥ä½œ;
- è¿™æ„å‘³ç€æ”¾JVMä¸­ä¸å­˜åœ¨éDaemonçº¿ç¨‹æ—¶,JVMä¼šé€€å‡º

```Java
public static void main(String[] args) throws InterruptedException {

    Thread t = new Thread() {

        @Override
        public void run() {
            try {
                System.out.println(Thread.currentThread().getName() + " running");
                Thread.sleep(100000);//â‘ 
                System.out.println(Thread.currentThread().getName() + " done.");
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }; //new
    
    t.setDaemon(true);//â‘¡
    t.start();
    Thread.sleep(5_000);   //JDK1.7
    System.out.println(Thread.currentThread().getName());
}
```

**æºç æ ‡è®°è§£è¯»ï¼š**

â‘ å˜é‡åä¸ºtçš„çº¿ç¨‹Thread-0ï¼Œç¡çœ 100ç§’ã€‚

â‘¡ä½†æ˜¯åœ¨ä¸»å‡½æ•°é‡ŒThread-0è®¾ç½®æˆäº†mainçº¿ç¨‹çš„å®ˆæŠ¤çº¿ç¨‹ã€‚æ‰€ä»¥5ç§’ä¹‹åmainçº¿ç¨‹ç»“æŸäº†ï¼Œå³ä½¿åœ¨â‘ è¿™é‡Œå®ˆæŠ¤çº¿ç¨‹è¿˜æ˜¯å¤„äºç¡çœ 100ç§’çš„çŠ¶æ€ï¼Œä½†ç”±äºä»–æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œéå®ˆæŠ¤çº¿ç¨‹mainç»“æŸäº†ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿå¿…é¡»ç»“æŸã€‚

1ã€ä½†æ˜¯å¦‚æœThread-0çº¿ç¨‹ä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå³ä½¿mainçº¿ç¨‹ç»“æŸäº†ï¼ŒThread-0çº¿ç¨‹ä»ç„¶ä¼šç¡çœ 100ç§’å†ç»“æŸã€‚

- å½“ä¸»çº¿ç¨‹æ­»äº¡åï¼Œå®ˆæŠ¤çº¿ç¨‹ä¼šè·Ÿç€æ­»äº¡
- å¯ä»¥å¸®åŠ©åšä¸€äº›è¾…åŠ©æ€§çš„ä¸œè¥¿ï¼Œå¦‚â€œå¿ƒè·³æ£€æµ‹â€
- è®¾ç½®å®ˆæŠ¤çº¿ç¨‹ï¼š`public final void setDaemon(boolean on)`



**ç”¨å¤„:**

Aå’ŒBä¹‹é—´æœ‰ä¸€æ¡ç½‘ç»œè¿æ¥ï¼Œå¯ä»¥ç”¨å®ˆæŠ¤çº¿ç¨‹æ¥è¿›è¡Œå‘é€å¿ƒè·³ï¼Œä¸€æ—¦Aå’ŒBè¿æ¥æ–­å¼€ï¼Œéå®ˆæŠ¤çº¿ç¨‹å°±ç»“æŸäº†ï¼Œå®ˆæŠ¤çº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯å¿ƒè·³æ²¡æœ‰å¿…è¦å†å‘é€äº†ï¼‰ä¹Ÿåˆšå¥½æ–­å¼€ã€‚

```Java
public static void main(String[] args) {

    Thread t = new Thread(() -> {
        Thread innerThread = new Thread(() -> {
            try {
                while (true) {
                    System.out.println("Do some thing for health check.");
                    Thread.sleep(1_000);
                }
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });

      //  innerThread.setDaemon(true);
        innerThread.start();

        try {
            Thread.sleep(1_000);
            System.out.println("T thread finish done.");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    });
    //t.setDaemon(true);
    t.start();
}

/*
è®¾ç½®è¯¥çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹å¿…é¡»åœ¨å¯åŠ¨å®ƒä¹‹å‰ã€‚å¦‚æœt.start()ä¹‹åï¼Œå†t.setDaemon(true);
ä¼šæŠ›å‡ºIllegalThreadStateException
*/Copy to clipboardErrorCopied
```

> è¾“å‡ºç»“æœï¼š
>
> Do some thing for health check. Do some thing for health check. T thread finish done. //æ­¤æ—¶mainçº¿ç¨‹å·²ç»ç»“æŸï¼Œä½†æ˜¯ç”±äºinnerThreadè¿˜åœ¨å‘é€å¿ƒè·³ï¼Œåº”ç”¨ä¸ä¼šå…³é—­ Do some thing for health check. Do some thing for health check. Do some thing for health check. Do some thing for health check.

> å®ˆæŠ¤çº¿ç¨‹è¿˜æœ‰å…¶å®ƒå¾ˆå¤šç”¨å¤„ï¼Œåœ¨åé¢çš„æ–‡ç« é‡Œè¿˜ä¼šæœ‰å‡ºç°ã€‚





### P10: joinæ–¹æ³•



**ğŸ´ä»£ç ä¸¾ä¾‹1 :**

```java
public static void main(String[] args) throws InterruptedException {
    Thread t1 = new Thread(() -> {
        IntStream.range(1, 1000)
                .forEach(i -> System.out.println(Thread.currentThread().getName() + "->" + i));
    });
    Thread t2 = new Thread(() -> {
        IntStream.range(1, 1000)
                .forEach(i -> System.out.println(Thread.currentThread().getName() + "->" + i));
    });

    t1.start();
    t2.start();
    t1.join();
    t2.join();

    Optional.of("All of tasks finish done.").ifPresent(System.out::println);
    IntStream.range(1, 1000)
            .forEach(i -> System.out.println(Thread.currentThread().getName() + "->" + i));
}

//t1,t2äº¤æ›¿æ‰§è¡Œ  æœ€åæ‰§è¡Œmainçº¿ç¨‹
```

- é»˜è®¤ä¼ å…¥çš„æ•°å­—ä¸º0ï¼Œè¿™é‡Œæ˜¯åœ¨mainçº¿ç¨‹é‡Œè°ƒç”¨äº†ä¸¤ä¸ªçº¿ç¨‹çš„join()ï¼Œæ‰€ä»¥mainçº¿ç¨‹ä¼šç­‰åˆ°Thread-0å’ŒThread-1çº¿ç¨‹æ‰§è¡Œå®Œå†æ‰§è¡Œå®ƒè‡ªå·±ã€‚
- joinå¿…é¡»åœ¨startæ–¹æ³•ä¹‹åï¼Œå¹¶ä¸”**join()æ˜¯å¯¹wait()çš„å°è£…**ã€‚ï¼ˆæºç ä¸­å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼‰

- ä¹Ÿå°±æ˜¯è¯´ï¼Œt.join()æ–¹æ³•é˜»å¡è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹(calling thread)è¿›å…¥ TIMED_WAITINGæˆ–WAITING çŠ¶æ€ã€‚ç›´åˆ°çº¿ç¨‹tå®Œæˆï¼Œæ­¤çº¿ç¨‹å†ç»§ç»­ã€‚
- joinä¹Ÿæœ‰äººç†è§£æˆ**æ’é˜Ÿ**ï¼Œæ¯”å¦‚åœ¨mainçº¿ç¨‹ä¸­è°ƒç”¨t.join()ï¼Œå°±æ˜¯tçº¿ç¨‹è¦æ’mainçº¿ç¨‹çš„é˜Ÿï¼Œmainçº¿ç¨‹è¦å»ç­‰å¾…ã€‚



**ğŸ´ä»£ç ä¸¾ä¾‹2 :**

```java
public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(() -> {
            IntStream.range(1, 1000)
                    .forEach(i -> System.out.println(Thread.currentThread().getName() + "->" + i));
        });
        Thread t2 = new Thread(() -> {
            try {
              //âœ¨  
              t1.join();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            IntStream.range(1, 1000)
                    .forEach(i -> System.out.println(Thread.currentThread().getName() + "->" + i));
        });

        t1.start();
        t2.start();
//        t1.join();
        t2.join();

        Optional.of("All of tasks finish done.").ifPresent(System.out::println);
        IntStream.range(1, 1000)
                .forEach(i -> System.out.println(Thread.currentThread().getName() + "->" + i));
    }
```

- è¿™é‡Œæ˜¯åœ¨t2ï¼ˆ**æˆ‘ä»¬ä»¥åå°±éƒ½ç”¨å˜é‡åæ¥ç§°å‘¼çº¿ç¨‹äº†**ï¼‰çº¿ç¨‹äº†ã€‚t1.join()äº†ã€‚æ‰€ä»¥t2çº¿ç¨‹ä¼šç­‰å¾…t1çº¿ç¨‹æ‰“å°å®Œï¼Œt2è‡ªå·±æ‰ä¼šæ‰“å°ã€‚ç„¶åt2.join()ï¼Œmainçº¿ç¨‹ä¹Ÿè¦ç­‰å¾…t2çº¿ç¨‹ã€‚æ€»ä½“æ‰§è¡Œé¡ºåºå°±æ˜¯t1-->t2-->main
- é€šè¿‡ä¸Šæ–¹ä¾‹å­å¯ä»¥ç”¨joinå®ç°ç±»ä¼¼äºCompletableFutureçš„å¼‚æ­¥ä»»åŠ¡ç¼–æ’ã€‚ï¼ˆåé¢ä¼šè®²ï¼‰





### P11: ä¸­æ–­

`1.javaä¸­çš„ä¸­æ–­å’Œæ“ä½œç³»ç»Ÿæ‰€è¯´çš„ä¸­æ–­ä¸ä¸€æ ·,javaçš„ä¸­æ–­å¯ä»¥æŒ‰ç…§çŠ¶æ€æ¥ç†è§£`

`2.ä¸­æ–­åªæ˜¯ä¸€ä¸ªçŠ¶æ€,javaå¯ä»¥é€‰æ‹©å¯¹è¿™ä¸ªä¸­æ–­è¿›è¡Œå“åº”æˆ–è€…ä¸å“åº”`



- **APIæ–¹æ³•**

```java
// Thread ç±»ä¸­çš„å®ä¾‹æ–¹æ³•ï¼ŒæŒæœ‰çº¿ç¨‹å®ä¾‹å¼•ç”¨å³å¯æ£€æµ‹çº¿ç¨‹ä¸­æ–­çŠ¶æ€
public boolean isInterrupted() {}

/*
1ã€Thread ä¸­çš„é™æ€æ–¹æ³•ï¼Œæ£€æµ‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­
2ã€æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•è¿”å›ä¸­æ–­çŠ¶æ€çš„åŒæ—¶ï¼Œä¼šå°†æ­¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€é‡ç½®ä¸º false
å¦‚æœæˆ‘ä»¬è¿ç»­è°ƒç”¨ä¸¤æ¬¡è¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œç¬¬äºŒæ¬¡çš„è¿”å›å€¼è‚¯å®šå°±æ˜¯ false äº†
*/
public static boolean interrupted() {}

// Thread ç±»ä¸­çš„å®ä¾‹æ–¹æ³•ï¼Œç”¨äºè®¾ç½®ä¸€ä¸ªçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¸º true
public void interrupt() {}
```

- **ä¸ºä»€ä¹ˆåˆ†åˆ«æœ‰ä¸€ä¸ªé™æ€å’Œå®ä¾‹çš„åˆ¤æ–­æ˜¯å¦ä¸­æ–­çš„æ–¹æ³•?**

  - interrupted()æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨Runnableæ¥å£å®ä¾‹ä¸­ä½¿ç”¨

  - isInterrupted()æ˜¯ä¸€ä¸ªThreadçš„å®ä¾‹æ–¹æ³•ï¼Œåœ¨é‡å†™Threadçš„runæ–¹æ³•æ—¶ä½¿ç”¨

    ```java
    public class ThreadInterrupt {
        public static void main(String[] args) throws InterruptedException {
            Thread t1 = new Thread(() -> {
                System.out.println(Thread.interrupted());
            });  //è¿™ä¸ªnew Threadç”¨çš„æ˜¯runnableæ¥å£é‚£ä¸ªæ„é€ å‡½æ•°
    
            Thread t2 = new Thread(){
                @Override
                public void run() {
                    System.out.println(isInterrupted());
                }
            };//è¿™ä¸ªnew Threadç”¨çš„å°±æ˜¯Threadçš„ç©ºå‚æ„é€ 
    
        }
    }
    ```

  - ä¹Ÿå°±æ˜¯è¯´æ¥å£ä¸­ä¸èƒ½è°ƒç”¨Threadçš„å®ä¾‹æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡é™æ€æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿä¸­æ–­



**ğŸ´wait()ä¸­æ–­æµ‹è¯•:**

```Java
public static void main(String[] args) {

    Thread t = new Thread() {
        @Override
        public void run() {
            while (true) {
                synchronized (MONITOR) {
                    try {
                        MONITOR.wait(10);
                    } catch (InterruptedException e) {
                        System.out.println("waitå“åº”ä¸­æ–­");//pos_1
                        e.printStackTrace();//pos_2
                        System.out.println(isInterrupted());//pos_3
                    }
                }
            }
        }
    };

    t.start();
    try {
        Thread.sleep(100);
    } catch (InterruptedException e) {
        System.out.println("sleepå“åº”ä¸­æ–­");
        e.printStackTrace();
    }
    System.out.println(t.isInterrupted());//pos_4
    t.interrupt();
    System.out.println(t.isInterrupted());//pos_5
}

4  >> false    pos_4
5  >> true     pos_5
waitå“åº”ä¸­æ–­    pos_1
3  >>false		 pos_3
java.lang.InterruptedException
	at java.lang.Object.wait(Native Method)
	at com.breeze.chapter3.CreateThread$1.run(CreateThread.java:21)
```



ã€€ã€€Thread.interrupt()æ–¹æ³•: ä½œç”¨æ˜¯ä¸­æ–­çº¿ç¨‹ã€‚å°†ä¼šè®¾ç½®è¯¥çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä½ï¼Œå³è®¾ç½®ä¸ºtrueï¼Œä¸­æ–­çš„ç»“æœçº¿ç¨‹æ˜¯æ­»äº¡ã€è¿˜æ˜¯ç­‰å¾…æ–°çš„ä»»åŠ¡æˆ–æ˜¯ç»§ç»­è¿è¡Œè‡³ä¸‹ä¸€æ­¥ï¼Œå°±å–å†³äºè¿™ä¸ªç¨‹åºæœ¬èº«ã€‚çº¿ç¨‹ä¼šä¸æ—¶åœ°æ£€æµ‹è¿™ä¸ªä¸­æ–­æ ‡ç¤ºä½ï¼Œä»¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åº”è¯¥è¢«ä¸­æ–­ï¼ˆä¸­æ–­æ ‡ç¤ºå€¼æ˜¯å¦ä¸ºtrueï¼‰ã€‚å®ƒå¹¶ä¸åƒstopæ–¹æ³•é‚£æ ·ä¼šä¸­æ–­ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€€

ã€€ã€€**interrupt()æ–¹æ³•åªæ˜¯æ”¹å˜ä¸­æ–­çŠ¶æ€ï¼Œä¸ä¼šä¸­æ–­ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹**ã€‚éœ€è¦ç”¨æˆ·è‡ªå·±å»ç›‘è§†çº¿ç¨‹çš„çŠ¶æ€ä¸ºå¹¶åšå¤„ç†ã€‚æ”¯æŒçº¿ç¨‹ä¸­æ–­çš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯**çº¿ç¨‹ä¸­æ–­åä¼šæŠ›å‡ºinterruptedExceptionçš„æ–¹æ³•**ï¼‰å°±æ˜¯åœ¨ç›‘è§†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œä¸€æ—¦çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è¢«ç½®ä¸ºâ€œä¸­æ–­çŠ¶æ€â€ï¼Œå°±ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ã€‚è¿™ä¸€æ–¹æ³•å®é™…å®Œæˆçš„æ˜¯ï¼Œç»™å—é˜»å¡çš„çº¿ç¨‹å‘å‡ºä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼Œè¿™æ ·å—é˜»çº¿ç¨‹æ£€æŸ¥åˆ°ä¸­æ–­æ ‡è¯†ï¼Œå°±å¾—ä»¥é€€å‡ºé˜»å¡çš„çŠ¶æ€ã€‚ 

  æ›´ç¡®åˆ‡çš„è¯´ï¼Œå¦‚æœçº¿ç¨‹è¢«Object.wait, Thread.joinå’ŒThread.sleepä¸‰ç§æ–¹æ³•ä¹‹ä¸€é˜»å¡ï¼Œæ­¤æ—¶è°ƒç”¨è¯¥çº¿ç¨‹çš„interrupt()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†æŠ›å‡ºä¸€ä¸ª InterruptedExceptionä¸­æ–­å¼‚å¸¸ï¼ˆè¯¥çº¿ç¨‹å¿…é¡»äº‹å…ˆé¢„å¤‡å¥½å¤„ç†æ­¤å¼‚å¸¸ï¼‰ï¼Œä»è€Œææ—©åœ°ç»ˆç»“è¢«é˜»å¡çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹æ²¡æœ‰è¢«é˜»å¡ï¼Œè¿™æ—¶è°ƒç”¨ interrupt()å°†ä¸èµ·ä½œç”¨ï¼Œç›´åˆ°æ‰§è¡Œåˆ°wait(),sleep(),join()æ—¶,æ‰é©¬ä¸Šä¼šæŠ›å‡º InterruptedExceptionã€‚



ğŸ´**join()ä¸­æ–­æµ‹è¯•**

```java
Thread t = new Thread() {
    @Override
    public void run() {
       while(true){
         
       }
    }
};

Thread main = Thread.currentThread();
Thread t2 = new Thread() {
    @Override
    public void run() {
        try {
            Thread.sleep(100);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        main.interrupt();  //pos_1
        System.out.println("interrupt");
    }
};

t2.start();
try {
    t.join();  //pos_2
} catch (InterruptedException e) {
    e.printStackTrace();
}

1ã€pos_2è¿™é‡Œjoinçš„æ˜¯mainçº¿ç¨‹ï¼Œæ‰€ä»¥pos_1è¿™é‡Œéœ€è¦ä¸­æ–­mainçº¿ç¨‹ï¼Œæ‰èƒ½æ”¶åˆ°ä¸­æ–­ä¿¡æ¯ã€‚

```



### P12: å…³é—­çº¿ç¨‹

#### D1: ä¼˜é›…çš„å…³é—­

- **é€šè¿‡booleanå€¼åˆ¤æ–­**

```Java
private static class Worker extends Thread {
    private volatile boolean start = true;

    @Override
    public void run() {
        while (start) {
           //æ‰§è¡Œç›¸åº”çš„å·¥ä½œ
        }
    }

    public void shutdown() {
        this.start = false;
    }
}

public static void main(String[] args) {
    Worker worker = new Worker();
    worker.start();

    try {
        Thread.sleep(10000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }

    worker.shutdown();
}
```

- **é€šè¿‡åˆ¤æ–­ä¸­æ–­çŠ¶æ€**

```java
private static class Worker extends Thread {

    @Override
    public void run() {
        while (true) {
            if (Thread.interrupted()){
                break;
            }
            //pos_1    
        }
    
    }
}

public static void main(String[] args) {
    Worker worker = new Worker();
    worker.start();

    try {
        Thread.sleep(3000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }

    worker.interrupt();
}

ä½†æ˜¯å¦‚æœpos_1ä½ç½®æœ‰ä¸€ä¸ªå¾ˆè´¹æ—¶çš„IOæ“ä½œï¼Œå°±æ²¡æœ‰æœºä¼šæ‰§è¡Œåˆ°ifåˆ¤æ–­é‚£é‡Œï¼Œä¹Ÿå°±ä¸èƒ½å…³é—­çº¿ç¨‹ã€‚æ‰€ä»¥å°±éœ€è¦ä¸‹é¢çš„æš´åŠ›æ–¹æ³•
```



#### D2: æš´åŠ›å…³é—­ (å®ˆæŠ¤çº¿ç¨‹)

```java
public class ThreadService {

    //æ‰§è¡Œçº¿ç¨‹
    private Thread executeThread;

    private boolean finished = false;

    public void execute(Runnable task) {
        executeThread = new Thread() {
            @Override
            public void run() {
                Thread runner = new Thread(task);
                runner.setDaemon(true);//åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œè®©å®ˆæŠ¤çº¿ç¨‹æ¥æ‰§è¡Œå·¥ä½œ

                runner.start();
                try {
/**
 * 1ã€è¦è®©executeThreadç­‰å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œï¼Œæ‰èƒ½æ‰§è¡ŒexecuteThreadè‡ªå·±çš„é€»è¾‘ã€‚ä¸ç„¶å®ˆæŠ¤çº¿ç¨‹
 *    å¯èƒ½å°±æ¥ä¸åŠæ‰§è¡ŒçœŸæ­£çš„å·¥ä½œå°±æ­»äº†ã€‚æ‰€ä»¥è¿™é‡Œè¦join
 * 2ã€runner.join()ï¼Œæ‰€ä»¥å®é™…ä¸Šç­‰å¾…çš„æ˜¯executeThread       //pos_1
 */
                    runner.join();
                    finished = true;
                } catch (InterruptedException e) {
                    //e.printStackTrace();
                }
            }
        };

        executeThread.start();
    }

    public void shutdown(long mills) {
        long currentTime = System.currentTimeMillis();
        while (!finished) {
            if ((System.currentTimeMillis() - currentTime) >= mills) {
                System.out.println("ä»»åŠ¡è¶…æ—¶ï¼Œéœ€è¦ç»“æŸä»–!");
                /*
                 * pos_1é‚£é‡Œï¼Œç”±äºå®é™…ç­‰å¾…çš„æ˜¯executeThreadï¼Œæ‰€ä»¥è¿™é‡Œä¸­æ–­executeThreadã€‚
                 * pos_1å°±å¯ä»¥æ•è·åˆ°ä¸­æ–­ï¼Œæ‰§è¡Œçº¿ç¨‹(executeThread)å°±ç»“æŸäº†ï¼Œè¿›è€ŒçœŸæ­£æ‰§è¡Œä»»åŠ¡çš„
                 * å®ˆæŠ¤çº¿ç¨‹runnerä¹Ÿç»“æŸäº†
                 */
                executeThread.interrupt();
                break;
            }

            try {
                executeThread.sleep(1);
            } catch (InterruptedException e) {
                System.out.println("æ‰§è¡Œçº¿ç¨‹è¢«æ‰“æ–­!");
                break;
            }
        }

        finished = false;
    }
}


public class ThreadCloseForce {


    public static void main(String[] args) {

        ThreadService service = new ThreadService();
        long start = System.currentTimeMillis();
        service.execute(() -> {
            //load a very heavy resource. æ¨¡æ‹Ÿä»»åŠ¡è¶…æ—¶
            /*while (true) {
            
            }*/
            try {
                Thread.sleep(5000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
        service.shutdown(10000);
        long end = System.currentTimeMillis();
        System.out.println(end - start);
    }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šåˆ†å¸ƒå¼æ–‡ä»¶æ‹·è´ï¼Œå¦‚æœæ‹·è´çš„æ—¶é—´è¿‡é•¿ï¼Œåˆ™å…³é—­è¯¥ç¨‹åºï¼Œé˜²æ­¢ç¨‹åºä¸€ç›´é˜»å¡ã€‚æˆ–è€…å…¶ä»–æ‰§è¡Œè€—æ—¶å¾ˆé•¿çš„ä»»åŠ¡

å®ˆæŠ¤çº¿ç¨‹çš„åº”ç”¨åœºæ™¯æœ‰å¾ˆå¤š



- åªè¦åŠŸå¤«æ·±,é“æµç£¨æˆé’ˆ!

- æ˜å¤©çš„ä½ ä¸€å®šä¼šæ„Ÿè°¢ä»Šå¤©åŠªåŠ›æ‹¼æçš„è‡ªå·±!

- ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·,å¤§èµ·å¤§è½é è‡ªå·±!

  ```c
  include<stdio.h>
  
  main(){
  	printf("hello world"!);
  }
  ```

  

### P13: æ­»é”

#### D1: ä»€ä¹ˆæ˜¯æ­»é”

- - å¤šä¸ªçº¿ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§åƒµå±€,å½“å¤„äºè¿™ç§åƒµæŒçŠ¶æ€æ—¶,è‹¥æ— å¤–åŠ›ä½œç”¨,å®ƒä»¬éƒ½å°†æ— æ³•å†å‘å‰æ¨è¿›.
  - ä¸¾ä¾‹: 
    - çº¿ç¨‹AæŒæœ‰é”Aç­‰å¾…è·å–é”B,è€Œæ­¤æ—¶çº¿ç¨‹BæŒæœ‰é”Bç­‰å¾…è·å–é”A.

#### D2: äº§ç”Ÿæ­»é”çš„åŸå› 

`å¯å½’ç»“ä¸ºå¦‚ä¸‹ä¸¤ç‚¹:`

- **ç«äº‰èµ„æº**
  - ç³»ç»Ÿä¸­çš„èµ„æºå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š
    - å¯å‰¥å¤ºèµ„æºï¼Œæ˜¯æŒ‡æŸè¿›ç¨‹åœ¨è·å¾—è¿™ç±»èµ„æºåï¼Œè¯¥èµ„æºå¯ä»¥å†è¢«å…¶ä»–è¿›ç¨‹æˆ–ç³»ç»Ÿå‰¥å¤ºï¼ŒCPUå’Œä¸»å­˜å‡å±äºå¯å‰¥å¤ºæ€§èµ„æºï¼›
    - ä¸å¯å‰¥å¤ºèµ„æºï¼Œå½“ç³»ç»ŸæŠŠè¿™ç±»èµ„æºåˆ†é…ç»™æŸè¿›ç¨‹åï¼Œå†ä¸èƒ½å¼ºè¡Œæ”¶å›ï¼Œåªèƒ½åœ¨è¿›ç¨‹ç”¨å®Œåè‡ªè¡Œé‡Šæ”¾ï¼Œå¦‚ç£å¸¦æœºã€æ‰“å°æœºç­‰
  - äº§ç”Ÿæ­»é”ä¸­çš„ç«äº‰èµ„æºä¹‹ä¸€æŒ‡çš„æ˜¯ç«äº‰ä¸å¯å‰¥å¤ºèµ„æºï¼ˆä¾‹å¦‚ï¼šç³»ç»Ÿä¸­åªæœ‰ä¸€å°æ‰“å°æœºï¼Œå¯ä¾›è¿›ç¨‹P1ä½¿ç”¨ï¼Œå‡å®šP1å·²å ç”¨äº†æ‰“å°æœºï¼Œè‹¥P2ç»§ç»­è¦æ±‚æ‰“å°æœºæ‰“å°å°†é˜»å¡ï¼‰
  - äº§ç”Ÿæ­»é”ä¸­çš„ç«äº‰èµ„æºå¦å¤–ä¸€ç§èµ„æºæŒ‡çš„æ˜¯ç«äº‰ä¸´æ—¶èµ„æºï¼ˆä¸´æ—¶èµ„æºåŒ…æ‹¬ç¡¬ä»¶ä¸­æ–­ã€ä¿¡å·ã€æ¶ˆæ¯ã€ç¼“å†²åŒºå†…çš„æ¶ˆæ¯ç­‰ï¼‰ï¼Œé€šå¸¸æ¶ˆæ¯é€šä¿¡é¡ºåºè¿›è¡Œä¸å½“ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”

- **è¿›ç¨‹é—´æ¨è¿›é¡ºåºéæ³•**
  - è‹¥P1ä¿æŒäº†èµ„æºR1,P2ä¿æŒäº†èµ„æºR2ï¼Œç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªè¿›ç¨‹å†å‘å‰æ¨è¿›ï¼Œä¾¿å¯èƒ½å‘ç”Ÿæ­»é”
  - ä¾‹å¦‚ï¼Œå½“P1è¿è¡Œåˆ°P1ï¼šRequestï¼ˆR2ï¼‰æ—¶ï¼Œå°†å› R2å·²è¢«P2å ç”¨è€Œé˜»å¡ï¼›å½“P2è¿è¡Œåˆ°P2ï¼šRequestï¼ˆR1ï¼‰æ—¶ï¼Œä¹Ÿå°†å› R1å·²è¢«P1å ç”¨è€Œé˜»å¡ï¼Œäºæ˜¯å‘ç”Ÿè¿›ç¨‹æ­»é”

#### D3: äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶

- äº’æ–¥æ¡ä»¶ï¼šè¿›ç¨‹è¦æ±‚å¯¹æ‰€åˆ†é…çš„èµ„æºè¿›è¡Œæ’å®ƒæ€§æ§åˆ¶ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºä»…ä¸ºä¸€è¿›ç¨‹æ‰€å ç”¨ã€‚
- è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šå½“è¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚
- ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨å®Œæ—¶ç”±è‡ªå·±é‡Šæ”¾ã€‚
- ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼šåœ¨å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹--èµ„æºçš„ç¯å½¢é“¾ã€‚

#### D4: é¿å…æ­»é”

- **é¿å…åµŒå¥—é”**

  è¿™æ˜¯æ­»é”æœ€å¸¸è§çš„åŸå› ,å¦‚æœå·²ç»æŒæœ‰ä¸€ä¸ªèµ„æº,è¯·é¿å…é”å®šå¦ä¸€ä¸ªèµ„æº.

- **åªé”éœ€è¦çš„éƒ¨åˆ†**

  å°½é‡åªå»é”å®šé”éœ€è¦çš„ç‰¹å®šå­—æ®µ,è€Œéå®Œæ•´å¯¹è±¡

- **é¿å…æ— é™æœŸç­‰å¾…**

  å¦‚æœä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨  join æ— é™æœŸäº’ç›¸ç­‰å¾…ä¹Ÿä¼šé€ æˆæ­»é”ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šç­‰å¾…çš„æœ€å¤§æ—¶é—´æ¥é¿å…è¿™ç§æƒ…å†µã€‚





### P14: ç­‰å¾…/é€šçŸ¥æœºåˆ¶(wait / notify)





**è¿‡ç¨‹:**

waitThreadé¦–å…ˆè·å–äº†å¯¹è±¡çš„é”,ç„¶åè°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•,ä»è€Œé‡Šæ”¾äº†é”å¹¶è¿›å…¥äº†å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­,è¿›å…¥ç­‰å¾…çŠ¶æ€.

notifyThreadéšåè·å¾—äº†å¯¹è±¡çš„é”,å¹¶è°ƒç”¨å¯¹è±¡çš„notify()æ–¹æ³•,å°†waitThreadä»ç­‰å¾…é˜Ÿé‡Œç§»åˆ°äº†åŒæ­¥é˜Ÿåˆ—ä¸­,æ­¤æ—¶waitThreadè¿›å…¥é˜»å¡çŠ¶æ€.

notifyThreadé‡Šæ”¾äº†é”ä¹‹å,waitThreadå†æ¬¡è·å–åˆ°é”å¹¶ä»wait()æ–¹æ³•è¿”å›ç»§ç»­æ‰§è¡Œ;







### P15: synchronized

- è¯­æ³•ä¸€

```java
synchronized(å¯¹è±¡) // çº¿ç¨‹1ï¼Œ çº¿ç¨‹2(blocked) 
{
   ä¸´ç•ŒåŒº
}
```



- è¯­æ³•äºŒ (ç”¨åœ¨)

```java
class Test{
		public synchronized void test() {
		
		} 
}

ç­‰ä»·äº

class Test{
		public void test() {
      	//é”çš„æ˜¯thiså¯¹è±¡
				synchronized(this) { 
				
				}
		} 
}
```

```java
class Test{
    public synchronized static void test() {

    } 
}

ç­‰ä»·äº
  
class Test{
		public static void test() {
      //é”çš„æ˜¯ç±»å¯¹è±¡
			synchronized(Test.class) { 
      
      }
		}
}
```



















